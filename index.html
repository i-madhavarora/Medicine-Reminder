<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Medicine Reminder</title>
<style>
body {font-family: Arial, sans-serif; max-width: 420px; margin: 2rem auto; padding: 1rem;}
h1 {text-align: center;}
label {display:block; margin-top:1rem; font-weight:bold;}
input, select, button {width:100%; padding:.6rem; margin-top:.3rem; box-sizing:border-box;}
button {background:#4CAF50; color:white; border:none; cursor:pointer; margin-top:1.5rem;}
button:hover {background:#45a049;}
.medicine-item {margin-top:1rem; padding:0.5rem; border:1px solid #ccc; border-radius:5px;}
</style>
</head>
<body>
<h1>Medicine Reminder</h1>

<form id="reminderForm">
  <label>Medicine Name
    <input id="medName" required>
  </label>

  <label>Type of Medicine
    <select id="medType" required>
      <option value="">--Select--</option>
      <option>Tablet</option>
      <option>Syrup</option>
      <option>Injection</option>
      <option>Other</option>
    </select>
  </label>

  <label>Date
    <input type="date" id="date" required>
  </label>

  <label>Time
    <input type="time" id="time" required>
  </label>

  <label>Repeat
    <select id="repeat" required>
      <option value="">--Select--</option>
      <option value="none">No Repeat</option>
      <option value="day">Every Day</option>
      <option value="12h">Every 12 Hours</option>
      <option value="6h">Every 6 Hours</option>
    </select>
  </label>

  <button type="submit">Add Reminder</button>
</form>

<h2>Scheduled Medicines:</h2>
<div id="medicineList"></div>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}

// Request permission once
async function ensureNotificationPermission() {
  if (Notification.permission !== 'granted') {
    await Notification.requestPermission();
  }
}
ensureNotificationPermission();

// Store and render medicines
function getMeds() { return JSON.parse(localStorage.getItem('meds')||'[]'); }
function saveMeds(meds) { localStorage.setItem('meds', JSON.stringify(meds)); }
function renderMeds() {
  const container = document.getElementById('medicineList');
  container.innerHTML='';
  getMeds().forEach(m => {
    const div = document.createElement('div');
    div.className='medicine-item';
    div.innerHTML = `<b>${m.name}</b> (${m.type})<br>${m.date} @ ${m.time} | Repeat: ${m.repeat}`;
    container.appendChild(div);
  });
}

// Schedule notifications automatically
function scheduleNotification(med) {
  const scheduleTime = new Date(`${med.date}T${med.time}:00`);
  const delay = scheduleTime - Date.now();
  if(delay<=0) return; // Skip past times

  setTimeout(() => {
    showNotification(med.name, med.type);
    if(med.repeat !== 'none') scheduleRepeats(med);
  }, delay);
}

function showNotification(name, type) {
  if(Notification.permission==='granted'){
    new Notification('Medicine Reminder', {
      body: `Time to take ${name} (${type})`,
      icon: 'https://cdn-icons-png.flaticon.com/512/2966/2966484.png'
    });
    new Audio('https://www.soundjay.com/button/beep-07.wav').play();
  }
}

function scheduleRepeats(med) {
  let interval;
  if(med.repeat==='day') interval = 24*60*60*1000;
  if(med.repeat==='12h') interval = 12*60*60*1000;
  if(med.repeat==='6h') interval = 6*60*60*1000;

  setInterval(() => showNotification(med.name, med.type), interval);
}

// Load existing medicines and schedule
getMeds().forEach(scheduleNotification);
renderMeds();

// Form submission
document.getElementById('reminderForm').addEventListener('submit', e=>{
  e.preventDefault();
  const med = {
    name: document.getElementById('medName').value.trim(),
    type: document.getElementById('medType').value,
    date: document.getElementById('date').value,
    time: document.getElementById('time').value,
    repeat: document.getElementById('repeat').value
  };
  if(!med.name || !med.type || !med.date || !med.time || !med.repeat){
    alert('Please fill all fields');
    return;
  }

  const meds = getMeds();
  meds.push(med);
  saveMeds(meds);
  renderMeds();
  scheduleNotification(med);

  // reset form
  document.getElementById('reminderForm').reset();
});
</script>
</body>
</html>
